(function(){function a(h,g,f){if(h.length===+h.length){for(var e=0,c=h.length;e<c;e++){if(g.call(f,e,h[e],h)===false){return}}}else{for(var d in h){if(h.hasOwnProperty(d)){if(g.call(f,d,h[d],h)===false){return}}}}}var b=function(g,d){this._render_start=g.render_start;this._data=g;this._render_timing={ht:0,vt:0,drt:0,tti:0,lt:0,fvt:0,crt:0};this._conf=d||{log_path:"http://static.tieba.baidu.com/tb/pms/img/st.gif",display:false};if(window.PDC&&PDC._opt.log_path){this._conf.log_path=PDC._opt.log_path}this._performance_timing={};this._metrics=[];this._is_send=false;var f=g.timing;for(var e in f){this._render_timing[e]=f[e]}this._readyCount=0;var c=this;this._measureScreen();this._measureNetworkTime();this._measureRenderTime();this._measureNetEnv();this._ready()};b.prototype._ready=function(){this._readyCount++;if(this._readyCount==1){this.send()}};b.prototype._measureScreen=function(){if(window.screen){this._metrics.push("_screen="+window.screen.width+"*"+window.screen.height+"|"+window.screen.availWidth+"*"+window.screen.availHeight)}};b.prototype._measureNetEnv=function(){var c=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{type:0};var e={mnt:0};e.mnt=c.type;for(var d in e){value=e[d]-0;this._metrics.push(d+"="+value)}};b.prototype._measureNetworkTime=function(){var e={dns:0,ct:0,st:0,tt:0};var f=0;if(window.performance&&performance.timing){var d=performance.timing;f=d.domainLookupStart;e.dns=d.domainLookupEnd;e.ct=d.connectEnd;e.st=d.responseStart;e.tt=d.responseEnd;e.dct=d.domComplete;e.olt=d.loadEventEnd;var c=PDC._render_start-d.navigationStart;c>0&&this._metrics.push("wtt="+c)}this._measureTime(f,e)};b.prototype._measureTime=function(e,c){var d=0;a(c,function(f,g){d=(""+g).length<8?g:g-e;this._metrics.push(f+"="+d)},this)};b.prototype._measureRenderTime=function(){if(window.performance&&window.performance.timing){var c=window.performance.timing;this._performance_timing=c;this._render_timing.lt=c.loadEventStart;if(c.loadEventEnd>0){this._render_timing.let=c.loadEventEnd}}if(this._render_timing.fvt==0){this._render_timing.fvt=this._render_timing.crt=this._render_timing.let}this._measureTime(this._render_start,this._render_timing)};b.prototype.send=function(){if(b._is_send){return}b._is_send=true;var g=this._data.env,h=this._metrics;for(var e in g){h.push(e+"="+g[e])}if(window.JSON&&window.localStorage&&localStorage.getItem("PMS_FT")){var d=JSON.parse(localStorage.getItem("PMS_FT"));var i=this._render_start,f=[];a(d,function(k,l){var j=[];a(l,function(m,n){j.push('"'+m+'":'+n)},this);f.push('"'+k+'":{'+j.join(",")+"}")},this);h.push("fis_timing={"+f.join(",")+"}");localStorage.removeItem("PMS_FT")}h.push("_t="+new Date()*1);var c=document.createElement("img");c.src=this._conf.log_path+"?"+h.join("&");window["___pms_img_"+new Date()*1]=c};if(!window.WPO_PDA){window.WPO_PDA=new b(PDC.metadata())}})();